.\" Automatically generated by Pandoc 3.1.11.1
.\"
.TH "env\-diff" "" "" "" ""
.SH NAME
env\-diff \- determine the effect of a command on the shell environment
.SH SYNOPSIS
.IP
.EX
env\-diff [OPTIONS] CMD
.EE
.SH DESCRIPTION
This command produces the most complete report of what \f[CR]CMD\f[R]
changes about the current shell environment
.IP \[bu] 2
Environment variables
.IP \[bu] 2
Shell variables (unexported)
.IP \[bu] 2
Shell arrays (associative and normal)
.IP \[bu] 2
Shell functions
.IP \[bu] 2
Shell options (set and shopt)
.IP \[bu] 2
Traps (see caveats)
.PP
For each section where changes arise, changes are separated into three
categories: new items, deleted items, and changed items.
.PP
For new items, the name and value is printed.
For deleted items, only the name is printed.
And for changed items, the values before and after are printed except
for some special cases.
.PP
Special cases include
.IP \[bu] 2
Colon delimited variables like PATH
.IP \[bu] 2
Shell function
.IP \[bu] 2
traps
.PP
For each of theses cases, the values before and after are compared in
the most useful way possible.
Colon delimited lists are compared by showing which elments were kept,
added, and removed (unless \f[CR]\-\-list\-diff\f[R] is given).
Functions and traps are compared by showing a git\-style diff of the
values before and after.
.PP
Also, some shell variables always change.
The variable \f[CR]$RANDOM\f[R] is a special variable that asks BASH to
give a random number.
Its value changes every time it is evaluated.
Variables relating to time like \f[CR]$EPOCHSECONDS\f[R] (bash 5) and
\f[CR]$SECONDS\f[R] will also always change.
.PP
Changes to these variables are not shown in the report unless the
\f[CR]\-\-no\-ignore\f[R] flag is given.
.SH CONFIGURATION
A configuration file \f[CR]\[ti]/.config/env\-diff.yml\f[R] stores
.IP \[bu] 2
Variables to ignore: Some variables change in a way that is irrelevant.
.IP \[bu] 2
What variables to process and display as lists
.PP
The repository comes with an example file that can be copied.
It can contains the toplevel sections:
.IP
.EX
colon_lists:
  \- PATH
space_lists:
  \- 
ignored_variables:
  \- BASH_SUBSHELL
  \- RANDOM
ignored_normal_arrays:
  \- BASH_LINENO
ignored_assoc_arrays:
  \- BASH_CMDS
.EE
.SH OPTIONS
Note: Options must come before \f[CR]CMD\f[R]
.SS \f[CR]\-\-list\-diff\f[R]
For \[aq]colon list\[aq] variables, they will be compared using set
comparison which ignores doubles, order, and empty elements (caused by
leading colon, trailing colon, or two consecutive colons).
.SS \f[CR]\-\-no\-ignore\f[R]
Disables the ignoring of changes to certain special variables.
.PP
Some variables are special and change no matter what like
\f[CR]BASHPID\f[R] (running \f[CR]CMD\f[R] and saving the final state
happens in a subshell where \f[CR]BASHPID\f[R] will be different).
.SS \f[CR]\-\-keep\-tmpdir\f[R]
Do not delete the temporary directory used to save states before and
after \f[CR]CMD\f[R].
These directories can rise to 10M in size if there are a lot of shell
functions.
Each function must be saved in its own file to garantee no parsing
errors.
Although the file may be smaller it has to take one block (usually 4k)
on disc.
.SS \f[CR]\-\-local\-tmpdir\f[R]
Create temporary directory ininside current working directory.
.PP
The temporarry directory is normally created inside \f[CR]$TMPDIR\f[R]
(or \f[CR]/tmp\f[R]) if \f[CR]TMPDIR\f[R] is not defined.
.SS \f[CR]\-F CONFIG_FILE\f[R]
Specify an alternate config file.
.SS \f[CR]\-\-help\f[R]
Display this manpage and exit
.SH CAVEATS
.SS Traps
Because of how traps are inherited by subshells and functions, if
\f[CR]CMD\f[R] sets traps on \f[CR]DEBUG\f[R] or \f[CR]RETURN\f[R],
these will not be seen unless the shell option \f[CR]extdebug\f[R] is
set prior to calling \f[CR]env\-diff\f[R] (setting it inside
\f[CR]env\-diff\f[R] was tried and does not work).
.PP
Some traps that do not get inherited by subshells may appear as deleted.
.SS Variables and functions
The BASH portion of this tool defines several shell functions and a few
shell variables.
All functions begin with \f[CR]_env\-diff\f[R] and all variables that
could be detected begin with \f[CR]_env_diff\f[R].
.PP
If \f[CR]CMD\f[R] changes one of these functions or variables, it has
the potential to interfere with the operations that happen after
\f[CR]CMD\f[R] is run.
.SH DEPENDENCIES
.IP \[bu] 2
jq
.IP \[bu] 2
standard UNIX tools (sort, comm, cut, cat, mkdir)
.IP \[bu] 2
python3
.PP
Optionally if the python package \f[CR]pygments\f[R] is available, it
will be used to hightlight the body of new shell functions.
.PP
The python package \f[CR]pyyaml\f[R]
(\f[CR]python3 \-m pip install [\-\-user] pyyaml\f[R]) must be installed
to read the config file \f[CR]\[ti]/.config/env\-diff.yml\f[R].
.SH AUTHOR
Philippe Carphin
